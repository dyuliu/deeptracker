"use strict";var application;!function(application){function registerModule(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(application.applicationName).requires.push(moduleName)}application.applicationName="cnn_ts_mean",application.applicationVendorDependencies=["ngSanitize","ngResource","ngAnimate","ui.router","nvd3","mgcrea.ngStrap"],application.registerModule=registerModule}(application||(application={}));
"use strict";var application;!function(application){function init(){angular.bootstrap(document,[application.applicationName])}angular.module(application.applicationName,application.applicationVendorDependencies);var BootstrapConfig=function(){function BootstrapConfig($locationProvider,$httpProvider){$locationProvider.html5Mode(!0).hashPrefix("!")}return BootstrapConfig.$inject=["$locationProvider","$httpProvider"],BootstrapConfig}();BootstrapConfig.$inject=["$locationProvider","$httpProvider"],angular.module(application.applicationName).config(BootstrapConfig),angular.element(document).ready(init)}(application||(application={}));
"use strict";var application;!function(application){application.registerModule("content")}(application||(application={}));
"use strict";var application;!function(application){application.registerModule("core")}(application||(application={}));
"use strict";var application;!function(application){application.registerModule("utils")}(application||(application={}));
"use strict";var application;!function(application){application.registerModule("vis")}(application||(application={}));
"use strict";var application;!function(application){var Config=function(){function Config($stateProvider){$stateProvider.state("home.info",{url:"/info",templateUrl:"src/client/content/views/info.client.view.html",controller:"InfoController"}).state("home.gallery",{url:"/gallery",templateUrl:"src/client/content/views/gallery.client.view.html",controller:"GalleryController"})}return Config.$inject=["$stateProvider"],Config}();Config.$inject=["$stateProvider"],angular.module("content").config(Config)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,$sce,Global){$scope.imgDatabase="imagenet",$scope.$watch(function(){return Global.getData("info").cls},function(n,o){n&&($scope.images=_.map(n,function(d){for(var tmp={cls:d.name,file:[]},i=0;i<18;i+=1)tmp.file.push(d.name+"/"+d.file[i]);return tmp}),$scope.images=_.sampleSize($scope.images,20))})}return Controller.$inject=["$scope","$sce","Global"],Controller}();Controller.$inject=["$scope","$sce","Global"],angular.module("content").controller("GalleryController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,$modal,$sce){this.$scope=$scope;$scope.models={googleNet:$sce.trustAsResourceUrl("http://ethereon.github.io/netscope/#/preset/googlenet"),resnet50:$sce.trustAsResourceUrl("http://ethereon.github.io/netscope/#/gist/db945b393d40bfa26006")};var modal=$modal({scope:$scope,templateUrl:"src/client/content/views/tpls/modal.client.tpls.html",show:!1});$scope.showModal=function(){modal.$promise.then(modal.show)}}return Controller.$inject=["$scope","$modal","$sce"],Controller}();Controller.$inject=["$scope","$modal","$sce"],angular.module("content").controller("InfoController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var Config=function(){function Config($stateProvider,$urlRouterProvider){$urlRouterProvider.rule(function($injector,$location){var path=$location.path(),hasTrailingSlash=path.length>1&&"/"===path[path.length-1];if(hasTrailingSlash){var newPath=path.substr(0,path.length-1);$location.replace().path(newPath)}}),$urlRouterProvider.otherwise("/home"),$stateProvider.state("home",{url:"/home",views:{"":{templateUrl:"src/client/core/views/home.client.view.html",controller:"HomeController"},"header@home":{templateUrl:"src/client/core/views/header.client.view.html"},"dashboard@home":{templateUrl:"src/client/core/views/dashboard.client.view.html",controller:"DashboardController"},"content@home":{templateUrl:"src/client/core/views/content.client.view.html"},"footer@home":{templateUrl:"src/client/core/views/footer.client.view.html"}}})}return Config.$inject=["$stateProvider","$urlRouterProvider"],Config}();Config.$inject=["$stateProvider","$urlRouterProvider"],angular.module("core").config(Config)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,DataManager,$q,Global,Pip){this.$scope=$scope,this.DataManager=DataManager,this.$q=$q,this.Global=Global,this.Pip=Pip;var this_=this;$scope.ratioList=Global.getRatioList(),setTimeout(function(){$("#sidebar-collapse").trigger("click"),$("#sidebar").hasClass("menu-min")&&$("#sidebar-collapse").trigger("click")},100),this._setBtnEvent(),this._setDBPanel(),this._setVisPanel(),$scope.$watch("config.record",function(n,o){Pip.emitRecordConfigChanged(n)},!0),$scope.$watch("config.label.show",function(n,o){n===!0&&Pip.emitLabelConfigChanged($scope.config.label)},!0),$scope.$watch("config.label.triangle",function(n,o){n===!0?$("polygon").css("display","inline"):$("polygon").css("display","none")}),$scope.$watch("config.label.immediate",function(n,o){n===!0?($scope.config.label.abnormal=0,$scope.config.label.threshold=30):($scope.config.label.abnormal=30,$scope.config.label.threshold=5);var _a=[this_.Global.getSelectedDB(),"json"],db=_a[0],parser=_a[1];$("#label-data-loading").removeClass("invisible"),this_.DataManager.fetchImg({db:db,type:"cls_stat",seqidx:[$scope.config.label.abnormal],cls:[],parser:parser},!1).then(function(data){$("#label-data-loading").addClass("invisible");var labelData=this_.Global.getData("label");labelData.clsStat=data,$scope.config.label.show&&Pip.emitLabelConfigChanged($scope.config.label)})}),$scope.$watch("config.layer",function(n,o){Pip.emitLayerConfigChanged(n)},!0),$scope.$watch("config.timebox",function(n,o){Pip.emitTimeboxConfigChanged(n)},!0)}return Controller.$inject=["$scope","DataManager","$q","Global","Pip"],Controller.prototype._setBtnEvent=function(){var this_=this;this_.$scope.pin=this_.Global.getConfig("timebox").pin,this_.$scope.click=function(eType){switch(eType){case"pin":var cf=this_.Global.getConfig("timebox");cf.pin=!cf.pin,this_.$scope.pin=cf.pin;break;case"reset":ace.data.remove("demo","widget-state"),ace.data.remove("demo","widget-order"),document.location.reload();break;case"upload":console.log("upload your db file");break;case"triangle":this_.Pip.emitLabelConfigChanged(this_.Global.getConfig("label"));break;case"showTopKernel":this_.Pip.emitShowTopKernel(null)}}},Controller.prototype._setDBPanel=function(){function myFilter(data,iterSet){for(var tmp=_.filter(data,function(d){return iterSet.has(d.iter)}),result=[],i=0;i<tmp.length-1;i+=1)tmp[i].iter!==tmp[i+1].iter&&result.push(tmp[i]);return result.push(_.last(tmp)),result}var this_=this;this_.$scope.imgDataset=this_.Global.getImgDBList(),this_.$scope.models=[],this_.$scope.selected={imgDataset:"imagenet",model:null},this_.$scope.$watch("selected.imgDataset",function(n,o){n&&(this_.$scope.models=this_.Global.getModelList()[n],"imagenet"===n?this_.DataManager.loadJson("/json/imagenet-tree.json").then(function(data){data=data.data,this_.Global.setData(data,"tree")}):"cifar"===n&&this_.DataManager.loadJson("/json/cifar-tree.json").then(function(data){data=data.data,this_.Global.setData(data,"tree")}))}),this_.$scope.$watch("selected.model",function(n,o){if(n){this_.Global.setSelectedDB(n);var _a=[n,"json"],db=_a[0],parser=_a[1];$("#label-data-loading").removeClass("invisible"),this_.DataManager.fetchImg({db:db,type:"cls_stat",seqidx:[this_.Global.getConfig("label").abnormal],cls:[],parser:parser},!1).then(function(data){$("#label-data-loading").addClass("invisible");var labelData=this_.Global.getData("label");labelData.clsStat=data}),$("#layer-data-loading").removeClass("invisible"),this_.$q.all([this_.DataManager.fetchLayer({db:db,type:"s_cratio",seqidx:[0],parser:parser},!1),this_.DataManager.fetchLayer({db:db,type:"hl_s_cratio",seqidx:[0],parser:parser},!1)]).then(function(data){$("#layer-data-loading").addClass("invisible")}),this_.$q.all({infoLayer:this_.DataManager.fetchInfo({db:db,type:"layer"}),infoCls:this_.DataManager.fetchInfo({db:db,type:"cls"}),lr:this_.DataManager.fetchRecord({db:db,type:"lr",parser:parser}),testError:this_.DataManager.fetchRecord({db:db,type:"test_error",parser:parser}),trainError:this_.DataManager.fetchRecord({db:db,type:"train_error",parser:parser}),testLoss:this_.DataManager.fetchRecord({db:db,type:"test_loss",parser:parser}),trainLoss:this_.DataManager.fetchRecord({db:db,type:"train_loss",parser:parser}),labelStat:this_.DataManager.fetchImg({db:db,type:"model_stat",parser:parser},!1)}).then(function(data){for(var iterSet=new Set,iterArray=[],i=0;i<data.labelStat.length;i+=1)iterSet.add(data.labelStat[i].iter),iterArray.push(data.labelStat[i].iter);this_.Global.setData({num:iterSet.size,set:iterSet,array:iterArray,picked:null},"iter"),this_.Global.setData({lr:myFilter(data.lr,iterSet),testError:_.filter(data.testError,function(d){return iterSet.has(d.iter)}),testLoss:_.filter(data.testLoss,function(d){return iterSet.has(d.iter)}),trainError:myFilter(data.trainError,iterSet),trainLoss:myFilter(data.trainLoss,iterSet)},"record"),this_.Global.setData({layer:data.infoLayer,cls:data.infoCls},"info"),this_.Global.setData({modelStat:data.labelStat,clsStat:null},"label"),this_.Pip.emitModelChanged(null)}).catch(function(reason){console.log(reason)})}})},Controller.prototype._setVisPanel=function(){var this_=this;this_.$scope.config=this_.Global.getConfig(),this_.$scope.recordTypeList=this_.Global.getRecordTypeList(),this_.$scope.layerTypeList=this_.Global.getLayerTypeList(),this_.$scope.layerChartType=this_.Global.getLayerChartType(),console.log(this_.$scope.layerChartType),this_.$scope.timeSlider={min:10,max:60,options:{floor:0,ceil:120}},$("#timerange").slider({orientation:"horizontal",range:!0,min:0,max:120,values:[20,60],slide:function(event,ui){var val=ui.values[$(ui.handle).index()-1]+"";ui.handle.firstChild||$("<div class='tooltip right in' style='display:none;left:16px;top:-6px;'><div class='tooltip-arrow'></div><div class='tooltip-inner'></div></div>").prependTo(ui.handle),$(ui.handle.firstChild).show().children().eq(1).text(val)}}).find("span.ui-slider-handle").on("blur",function(){$(this.firstChild).hide()}),this_.$scope.spinnerChange=function(step,key){if("threshold"===key){var val=+this_.$scope.config.label[key]+step;if(val<0)return;if("abnormal"===key&&val>100)return;this_.$scope.config.label[key]=val}else if("band"===key){var val=+this_.$scope.config.layer[key]+step;if(val<1)return;this_.$scope.config.layer[key]=val}},this_.$scope.labelRender=function(step,key){this_.Pip.emitLabelConfigChanged(this_.$scope.config.label)}},Controller}();Controller.$inject=["$scope","DataManager","$q","Global","Pip"],angular.module("core").controller("DashboardController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var HomeController=function(){function HomeController($scope,$location){$scope.actives={info:!1,gallery:!1,visualization:!1};var this_=this;$scope.subPageTitle=this_._getSubPageTitle($scope.actives),$scope.$watch(function(){return $location.url()},function(url,oldUrl){$scope.actives.info=_.endsWith(url,"info"),$scope.actives.gallery=_.endsWith(url,"gallery"),$scope.actives.visualization=_.endsWith(url,"visualization"),$scope.subPageTitle=this_._getSubPageTitle($scope.actives)}),$scope.showScroll=!1,$(window).on("scroll",function(e){$(".my-btn-scroll-up").removeClass("invisible")}),$scope.click=function(){$("html,body").animate({scrollTop:0},500,function(){$(".my-btn-scroll-up").addClass("invisible")})}}return HomeController.$inject=["$scope","$location"],HomeController.prototype._getSubPageTitle=function(actives){var title="";return _.each(actives,function(d,k){d&&(title=k)}),_.capitalize(title)},HomeController}();HomeController.$inject=["$scope","$location"],application.HomeController=HomeController,angular.module("core").controller("HomeController",HomeController)}(application||(application={}));
var application;!function(application){"use strict";var DataManager=function(){function DataManager($q,$http,Global,HTTP){this.$q=$q,this.$http=$http,this.Global=Global,this.HTTP=HTTP}return DataManager.$inject=["$q","$http","Global","HTTP"],DataManager.prototype.fetchInfo=function(options){var _this=this;return this.$q(function(resolve,reject){_this.HTTP.request({api:"info",config:options}).then(function(data){resolve(data)})})},DataManager.prototype.fetchRecord=function(options){var _this=this;return this.$q(function(resolve,reject){_this.HTTP.request({api:"record",config:options}).then(function(data){resolve(data)})})},DataManager.prototype.fetchLayer=function(options,stream){void 0===stream&&(stream=!0);var this_=this,deferred=this_.$q.defer(),opt={api:"layer",config:options};return stream?this_.HTTP.streamRequest(opt).then(function(data){deferred.resolve(data)}):this_.HTTP.request(opt).then(function(data){deferred.resolve(data)}),deferred.promise},DataManager.prototype.fetchKernel=function(options,stream){void 0===stream&&(stream=!0);var this_=this,deferred=this_.$q.defer(),opt={api:"kernel",config:options};return stream?this_.HTTP.streamRequest(opt).then(function(data){deferred.resolve(data)}):this_.HTTP.request(opt).then(function(data){deferred.resolve(data)}),deferred.promise},DataManager.prototype.fetchImg=function(options,stream){void 0===stream&&(stream=!0);var this_=this,deferred=this_.$q.defer(),opt={api:"img",config:options};return stream?this_.HTTP.streamRequest(opt).then(function(data){deferred.resolve(data)}):this_.HTTP.request(opt).then(function(data){deferred.resolve(data)}),deferred.promise},DataManager.prototype.loadJson=function(url){var this_=this,deferred=this_.$q.defer();return this_.$http({url:url,method:"GET"}).then(function(data){deferred.resolve(data)}),deferred.promise},DataManager}();DataManager.$inject=["$q","$http","Global","HTTP"],angular.module("utils").service("DataManager",DataManager)}(application||(application={}));
var application;!function(application){"use strict";var DataProcessor=function(){function DataProcessor(){}return DataProcessor.prototype.stackedAreaChart=function(rawData){var res;return rawData=_.sortBy(rawData,["iter"]),_.each(rawData,function(d){res?_.each(res,function(dd){dd.values.push([d.iter,d.value[dd.key]])}):(res=[],_.each(d.value,function(dd,dkey){res.push({key:dkey,values:[[d.iter,dd]]})}))}),res},DataProcessor}();DataProcessor.$inject=[],angular.module("utils").service("DataProcessor",DataProcessor)}(application||(application={}));
var application;!function(application){"use strict";var Global=function(){function Global(){this._init(),this._addAPI("recordTypeList"),this._addAPI("layerTypeList"),this._addAPI("kernelTypeList"),this._addAPI("layerChartType"),this._addAPI("imgTypeList"),this._addAPI("imgDBList"),this._addAPI("modelList"),this._addAPI("selectedDB"),this._addAPI("data"),this._addAPI("config"),this._addAPI("ratioList")}return Global.factory=function(){var service=function(){var tmp=(new Global).exports;return tmp};return service.$inject=[],service},Global.prototype._addAPI=function(name){var this_=this,setName="set"+name[0].toUpperCase()+name.slice(1),getName="get"+name[0].toUpperCase()+name.slice(1);this_.exports[setName]=function(d,t){t?this_.all[name][t]=d:this_.all[name]=d},this_.exports[getName]=function(t){return t?this_.all[name][t]:this_.all[name]}},Global.prototype._init=function(){this.exports={},this.all={},this.all.recordTypeList=[{label:"learning rate",value:"lr"},{label:"validation error",value:"testError"},{label:"validation loss",value:"testLoss"},{label:"train error",value:"trainError"},{label:"train loss",value:"trainLoss"}],this.all.layerTypeList=[{label:"mean magnitude (norm1)",value:"norm1"},{label:"mean magnitude (norm2)",value:"norm2"},{label:"sum",value:"sum"},{label:"mean",value:"mean"},{label:"std",value:"std"},{label:"var",value:"var"},{label:"max",value:"max"},{label:"mid",value:"mid"},{label:"min",value:"min"},{label:"quarter1",value:"quarter1"},{label:"quarter3",value:"quarter3"}],this.all.layerChartType=[{label:"crchart",value:"crChart"},{label:"boxplot",value:"boxPlot"},{label:"linechart",value:"lineChart"},{label:"horizon graph",value:"horizonGraph"}],this.all.imgDBList=["imagenet","cifar"],this.all.modelList={imagenet:[{label:"resnet50-sgd-1P4G-1x",value:"imagenet-1x-1"},{label:"resnet50-sgd-1P4G-1x-lr0.5",value:"imagenet-1x-lr0.5"},{label:"resnet50-sgd-1P4G-1x-lr2",value:"imagenet-1x-lr2"},{label:"resnet50-sgd-1P4G-1x-m0",value:"imagenet-1x-m0"},{label:"resnet50-sgd-1P4G-2x",value:"imagenet-2x-1"},{label:"resnet50-sgd-1P4G-2x-lr2",value:"imagenet-2x-lr2"},{label:"resnet50-sgd-1P4G-8x",value:"imagenet-8x-1"}],cifar:[{label:"resnet164-sgd-1P4G-1x-1",value:"cifar-1x-1"},{label:"resnet164-sgd-1P4G-1x-2",value:"cifar-1x-2"},{label:"resnet164-sgd-1P4G-1x-lr0.5",value:"cifar-1x-lr0.5"},{label:"resnet164-sgd-1P4G-1x-lr2",value:"cifar-1x-lr2"},{label:"resnet164-sgd-1P4G-1x-m0",value:"cifar-1x-m0"},{label:"resnet164-sgd-1P4G-2x-1",value:"cifar-2x-1"},{label:"resnet164-sgd-1P4G-2x-lr0.5",value:"cifar-2x-lr0.5"},{label:"resnet164-sgd-1P4G-2x-lr2",value:"cifar-2x-lr2"},{label:"resnet164-sgd-1P4G-4x",value:"cifar-4x-1"},{label:"resnet164-sgd-1P4G-8x",value:"cifar-8x-1"}]},this.all.selectedDB=null,this.all.data={iter:{num:0,set:null,array:null,picked:null},tree:null,info:{db:null,layer:null,cls:null},record:{lr:null,testError:null,trainError:null,testLoss:null,trainLoss:null},label:{modelStat:null,clsStat:null}},this.all.config={timebox:{show:!0,pin:!1},record:{lr:!0,testError:!0,testLoss:!0,trainError:!0,trainLoss:!0,show:!1},label:{immediate:!1,mds:!1,show:!1,threshold:5,abnormal:30,triangle:!1},layer:{gw:"g",type:"norm1",chartType:"boxPlot",band:1,show:!1,sameScale:!1,level:0,selectedRatio:[9,18,27,36]}},this.all.ratioList=this._genRatios(6,1)},Global.prototype._genRatios=function(scales,step){var s=.1,r=[],idx=1;r.push({value:0,label:"unlimited"});for(var i=0;i<scales;i+=1){for(var j=9;j>0;j-=step)r.push({value:idx,label:"<"+d4.format(".1r")(s*j)}),idx++;s/=10}return r},Global}();application.Global=Global,angular.module("utils").factory("Global",Global.factory())}(application||(application={}));
var application;!function(application){var HTTP=function(){function HTTP($q,$http){this.$q=$q,this.$http=$http}return HTTP.factory=function(){var service=function($q,$http){return new HTTP($q,$http)};return service.$inject=["$q","$http"],service},HTTP.prototype.request=function(options){var this_=this,api=options.api,url=options.url,method=options.method,config=options.config,parser=config.parser=config.parser?config.parser:"json",msg=_.merge(options,{url:url?url:"/api/"+api,method:method?method:"POST",responseType:"json"===parser?"text":"arraybuffer",transformResponse:"json"===parser?this_._jsonParser:this_._bsonParser,data:"GET"!==method?config:null});return this_.$q(function(resolve,reject){this_.$http(msg).then(function(res){resolve(res.data)},function(err){console.log(err),reject(err)})})},HTTP.prototype.streamRequest=function(options){var this_=this,api=options.api,url=options.url,method=options.method,config=options.config,parser=config.parser=config.parser?config.parser:"bson",msg=_.merge(options,{url:url?url:"/api/stream/"+api,method:method?method:"POST",responseType:"json"===parser?"text":"arraybuffer",transformResponse:"json"===parser?this_._jsonParser:this_._bsonParser,data:"GET"!==method?config:null});return this_.$q(function(resolve,reject){this_.$http(msg).then(function(res){resolve(res.data)},function(err){console.log(err),reject(err)})})},HTTP.prototype._jsonParser=function(data){function abtostr(buffer){for(var arr=new Uint8Array(buffer),str="",chunkSize=65535,len=arr.length,i=0;i*chunkSize<len;i+=1)str+=String.fromCharCode.apply(null,arr.subarray(i*chunkSize,(i+1)*chunkSize));if(/[\u0080-\uffff]/.test(str))throw new Error("this string seems to contain (still encoded) multibytes");return str}var result,strData="string"==typeof data?data:abtostr(data),pos=strData.indexOf("\n");if(pos>=0){var offset=0;for(result=[];pos>=0;){var substr=strData.substring(offset,pos);result=result.concat(JSON.parse(substr)),offset=pos+1,pos=strData.indexOf("\n",offset)}}else result=JSON.parse(strData);return result},HTTP.prototype._bsonParser=function(data){if(!(data instanceof ArrayBuffer))return console.error("bsonParser: not arraybuffer"),data;for(var bufView=new Uint8Array(data),offset=0,bson=new BSON,proto=bson.serialize({}).__proto__,result=[],calcLen=function(d,i){return d[i]+d[i+1]*Math.pow(16,2)+d[i+2]*Math.pow(16,4)+d[i+3]*Math.pow(16,6)},parse=function(d){return d.__proto__=proto,bson.deserialize(d)},count=0;offset<bufView.length;){var len=calcLen(bufView,offset);count+=len;var obj=parse(bufView.subarray(offset+4,offset+4+len));result.push(obj),offset+=4+len}return result},HTTP}();angular.module("utils").factory("HTTP",HTTP.factory())}(application||(application={}));
var application;!function(application){"use strict";var Pip=function(){function Pip($rootScope){this.exports={},this.transName=function(nm){return nm[0].toUpperCase()+nm.slice(1)},this.addEvent=function(evtName){var name=this.transName(evtName);this.exports["emit"+name]=function(msg){$rootScope.$broadcast(evtName,msg)},this.exports["on"+name]=function(scope,cb){scope.$on(evtName,function(event,msg){cb(msg)})}},this.addEvent("urlChanged"),this.addEvent("vlDiv"),this.addEvent("modelChanged"),this.addEvent("timeChanged"),this.addEvent("recordConfigChanged"),this.addEvent("labelConfigChanged"),this.addEvent("layerConfigChanged"),this.addEvent("timeboxConfigChanged"),this.addEvent("showModal"),this.addEvent("syncHorizonScale"),this.addEvent("timeMouseOver"),this.addEvent("timeMouseOut"),this.addEvent("timeMouseMove"),this.addEvent("timePicked"),this.addEvent("showTopKernel")}return Pip.factory=function(){var service=function($rootScope){return new Pip($rootScope).exports};return service.$inject=["$rootScope"],service},Pip}();application.Pip=Pip,angular.module("utils").factory("Pip",Pip.factory())}(application||(application={}));
"use strict";var application;!function(application){var Config=function(){function Config($stateProvider){$stateProvider.state("home.visualization",{url:"/visualization",templateUrl:"src/client/visualization/views/visualization.client.view.html",controller:"VisualizationController"})}return Config.$inject=["$stateProvider"],Config}();Config.$inject=["$stateProvider"],angular.module("vis").config(Config)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,Global){this.$scope=$scope,this.Global=Global;var this_=this,dbName=this_.Global.getSelectedDB();if(_.startsWith(dbName,"imagenet")?$scope.imgDatabase="imagenet":_.startsWith(dbName,"cifar")&&($scope.imgDatabase="cifar"),$scope.clsName=$scope.cls,$scope.myStyle={},"class"===$scope.type){var data=_.find(this_.Global.getData("info").cls,function(o){return o.name===$scope.cls});$scope.images=data.file}else"file"===$scope.type&&($scope.simg=$scope.name)}return Controller.$inject=["$scope","Global"],Controller}();Controller.$inject=["$scope","Global"],angular.module("vis").controller("ImgModalController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,DataManager,Global,$q,Pip,$timeout,$modal,$rootScope){function showDetail(clsName){DataManager.fetchImg({db:Global.getSelectedDB(),type:"detail",cls:[clsName],parser:"json"},!1).then(function(data){$scope.optionsDetail[clsName]=this_._setOptions("pixelChartWithLine",data.length),$scope.optionsDetail[clsName].threshold=$scope.optionsCls[clsName].threshold,$scope.optionsDetail[clsName].max=$scope.optionsCls[clsName].max,$scope.dataDetail[clsName]={pixelChart:data,lineChart:$scope.dataCls[clsName].linechartData}})}function act(conf){if(console.log("act"),first){$scope.optionsHeatLine=this_._setOptions("heatline"),$scope.optionsHeatLine.height=100;var gd=Global.getData();$scope.dataModel={heatmapData:Global.getData("record").testError,linechartData:gd.label.modelStat,max:d4.max(gd.label.modelStat,function(d){return d.value})},$scope.optionsCls={},$scope.dataCls=this_._processData("cls_heatline",gd.label.clsStat,$scope.dataModel.max),gd.label.clsStat=null,first=!1}var selectedCls=[],maxPMax=Number.MIN_SAFE_INTEGER;_.each($scope.dataCls,function(d,k){d.pmax>maxPMax&&(maxPMax=d.pmax)});var root="/assets/images/gallery/",currentDBName=this_.Global.getSelectedDB();if(_.startsWith(currentDBName,"imagenet")?root+="imagenet/":_.startsWith(currentDBName,"cifar")&&(root+="cifar/"),_.each($scope.dataCls,function(d,k){var findedCls=_.find(Global.getData("info").cls,function(o){return o.name===k}),firstFile=findedCls.file[0];d.pmax>=conf.threshold&&($scope.optionsCls[k]=this_._setOptions("heatline"),$scope.optionsCls[k].threshold=conf.threshold,$scope.optionsCls[k].triangle=conf.triangle,$scope.optionsCls[k].immediate=conf.immediate,$scope.optionsCls[k].max=maxPMax,selectedCls.push({name:k,pmax:d.pmax,file:root+k+"/"+firstFile}))}),conf.mds){var tmp_1=[];_.each(selectedCls,function(d){var v=_.map($scope.dataCls[d.name].heatmapData,function(o){return o.value});tmp_1.push({name:d.name,value:v})}),$scope.selectedCls=mdsLayout(tmp_1)}else $scope.selectedCls=_.reverse(_.sortBy(selectedCls,["pmax"]))}function mdsLayout(data){for(var result=[],distMatrix=[],length=data.length,max=-1,i=0;i<length;i+=1){distMatrix.push(Array(length).fill(0)),distMatrix[i][i]=0;for(var j=i-1;j>=0;j-=1)distMatrix[i][j]=distMatrix[j][i];for(var j=i+1;j<length;j+=1)distMatrix[i][j]=computeDist2(data[i].value,data[j].value),distMatrix[i][j]>max&&(max=distMatrix[i][j])}for(var fs=d4.scaleLinear().range([0,1]).domain([0,max]).clamp(!0),i=0;i<length;i+=1)for(var j=0;j<length;j+=1)distMatrix[i][j]=fs(distMatrix[i][j]);var coordinate=_.map(LG.utils.Mds.mds(distMatrix,1),function(d,i){return[i,d[0]]});coordinate=_.sortBy(coordinate,function(d){return d[1]});for(var i=0;i<data.length;i+=1){var idx=coordinate[i][0];result.push({name:data[idx].name,pmax:data[idx.pmax]})}return result}function computeDist2(va,vb){var nva=numeric.norm2(va),nvb=numeric.norm2(vb);return 0!==nva&&0!==nvb?1-numeric.dot(va,vb)/(numeric.norm2(va)*numeric.norm2(vb)):1}this.$scope=$scope,this.DataManager=DataManager,this.Global=Global,this.$q=$q,this.Pip=Pip,this.$timeout=$timeout,this.$modal=$modal,this.$rootScope=$rootScope;var first,this_=this;this_._init();var modal=$modal({scope:$scope,templateUrl:"src/client/visualization/views/tpls/img-modal.client.tpls.html",show:!1,controller:"ImgModalController",keyboard:!0});$scope.showModal=function(name,type){modal.$scope.cls=name,modal.$scope.type="class",modal.$promise.then(modal.show)},Pip.onShowModal($scope,function(msg){modal.$scope.name=msg.key,modal.$scope.cls=msg.cls,modal.$scope.type="file",modal.$promise.then(modal.show)}),$scope.click=function(type,clsName){"open"===type?($scope.open=!$scope.open,$scope.open):"flip"===type?($scope.flip[clsName]=!$scope.flip[clsName],$scope.flip[clsName]&&showDetail(clsName)):"zoomin"===type?$scope.$broadcast("zoom",{type:"in",cls:clsName}):"zoomout"===type&&$scope.$broadcast("zoom",{type:"out",cls:clsName})},Pip.onTimeChanged($scope,function(iter){console.log("select iter: ",iter)}),Pip.onModelChanged($scope,function(msg){first=!0}),Pip.onLabelConfigChanged($scope,function(conf){console.log(conf),conf.show===!0&&act(conf)})}return Controller.$inject=["$scope","DataManager","Global","$q","Pip","$timeout","$modal","$rootScope"],Controller.prototype._init=function(){var this_=this,cls=this_.Global.getData("info").cls;this_.$scope.open=!1,this_.$scope.flip={},this_.$scope.optionsDetail={},_.each(cls,function(c){this_.$scope.flip[c.name]=!1}),this_.$scope.dataDetail={},this_.$timeout(function(){$("#widget-container-labelinfo .scrollable").each(function(){var $this=$(this);$(this).ace_scroll({size:$this.attr("data-size")||100})})},100),$("#widget-container-labelinfo").mouseenter(function(){$("#widget-container-labelinfo .widget-header:first-child").removeClass("invisible"),this_.$scope.$apply(function(){this_.$scope.btnShow=!0})}).mouseleave(function(){$("#widget-container-labelinfo .widget-header:first-child").addClass("invisible"),this_.$scope.$apply(function(){this_.$scope.btnShow=!1})})},Controller.prototype._processData=function(type){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];var data,max,result={};switch(type){case"cls_heatline":_a=[rest[0],rest[1]],data=_a[0],max=_a[1];for(var _b=0,data_1=data;_b<data_1.length;_b++){var d=data_1[_b];result[d.cls]||(result[d.cls]={heatmapData:[],linechartData:[],max:max,pmax:-1}),result[d.cls].heatmapData.push({iter:d.iter,value:d.testError}),result[d.cls].linechartData.push({iter:d.iter,value:d.value}),result[d.cls].pmax=result[d.cls].pmax<d.value?d.value:result[d.cls].pmax}return _.each(result,function(d){d.heatmapData=_.sortBy(d.heatmapData,["iter"]),d.linechartData=_.sortBy(d.linechartData,["iter"])}),result;case"cls_pixelchart":}var _a},Controller.prototype._setOptions=function(type,height){var options,this_=this;switch(type){case"heatline":options={width:this_.Global.getData("iter").num+30,height:height?height:16,cellWidth:1,color:d4.scaleSequential(d4.interpolateRdYlGn),margin:{top:1,right:30,bottom:0,left:0},type:"cls",lineChart:!1};break;case"pixelChartWithLine":options={width:this_.Global.getData("iter").num+30,height:height?height+20:50,cellWidth:1,pixelChart:!0,lineChart:!0,color:function(d){return 1===d?"#7fc97f":"#fdc086"},marginTop:9,margin:{top:9,right:30,bottom:0,left:0}}}return options},Controller}();Controller.$inject=["$scope","DataManager","Global","$q","Pip","$timeout","$modal","$rootScope"],angular.module("vis").controller("LabelController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,DataManager,Global,$q,Pip,$timeout){function openPixelChart(d){var layerArray=Global.getData("info").layer,lid=_.find(layerArray,function(o){return o.name===d.name}).lid,_a=[Global.getSelectedDB(),"json"],db=_a[0],parser=_a[1],type="i_cosine";$("#layer-data-loading").removeClass("invisible"),DataManager.fetchKernel({db:db,type:type,layer:[lid],parser:parser},!1).then(function(data){$("#layer-data-loading").addClass("invisible"),$scope.optionsDetail[d.name]=this_._setOptions("pixelChartWithLine"),$scope.optionsDetail[d.name].height=data.length+4,$scope.optionsDetail[d.name].name=d.name;for(var _loop_1=function(i){var _a=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],min=_a[0],max=_a[1];_.each(data,function(dd,j){min>dd.value[i]&&(min=dd.value[i]),max<dd.value[i]&&(max=dd.value[i]),dd.index||(dd.index=+j)});var nf=d4.scaleLinear().domain([min,max]).range([.01,.95]).clamp(!0);_.each(data,function(dd){dd.value[i]=nf(dd.value[i])})},i=0;i<data[0].iter.length;i+=1)_loop_1(i);$scope.dataDetail[d.name]={pixelChart:data,lineChart:null}})}function act(conf){var globalData=Global.getData(),layerArray=globalData.info.layer,tree=globalData.tree,iterSet=globalData.iter.set;if(allLayers=_.map(layerArray,function(d){return d.lid}),layers=_.keyBy(layerArray,function(o){return o.name}),$scope.layers=layers,$scope.opened={},$scope.options={},$scope.optionsDetail={},$scope.optionsHGraph={},$scope.optionsCR={},$scope.dataCR={},$scope.dataDetail={},$scope.dataHGraph={},$scope.showTypes={},$scope.size={},$scope.conf=conf,$scope.dataTree=tree,"lineChart"===conf.chartType){for(var _i=0,tree_1=tree;_i<tree_1.length;_i++){var d=tree_1[_i];if($scope.opened[d.name]=!1,$scope.options[d.name]=this_._setOptions("sparklinePlus"),$scope.size[d.name]=0,d.nodes||($scope.size[d.name]=layers[d.name].kernelNum*layers[d.name].channels*layers[d.name].kernelWidth+layers[d.name].kernelHeight),$scope.showTypes[d.name]="nvd3",layerTree[d.name]=d,d.nodes){hlLayers.push(d.name);for(var _a=0,_b=d.nodes;_a<_b.length;_a++){var dn=_b[_a];if(dn.parent=d,$scope.opened[dn.name]=!1,$scope.options[dn.name]=this_._setOptions("sparklinePlus"),$scope.size[dn.name]=0,$scope.showTypes[dn.name]="nvd3",layerTree[dn.name]=dn,dn.nodes){hlLayers.push(dn.name);for(var _c=0,_d=dn.nodes;_c<_d.length;_c++){var dnn=_d[_c];dnn.parent=dn,$scope.opened[dnn.name]=!1,$scope.options[dnn.name]=this_._setOptions("sparklinePlus"),$scope.size[dnn.name]=layers[dnn.name].kernelNum*layers[dnn.name].channels*layers[dnn.name].kernelWidth+layers[dnn.name].kernelHeight,$scope.size[dn.name]+=$scope.size[dnn.name],$scope.size[d.name]+=$scope.size[dnn.name],$scope.showTypes[dnn.name]="nvd3",layerTree[dnn.name]=dnn}}}}}var db=Global.getSelectedDB(),parser="json";$("#layer-data-loading").removeClass("invisible"),$q.all([DataManager.fetchLayer({db:db,type:conf.gw+"_"+conf.type,parser:parser},!1),DataManager.fetchLayer({db:db,type:"hl_"+conf.gw+"_"+conf.type,parser:parser},!1)]).then(function(data){$("#layer-data-loading").addClass("invisible"),$scope.data={},data[0]=_.filter(data[0],function(d){return iterSet.has(d.iter)}),data[1]=_.filter(data[1],function(d){return iterSet.has(d.iter)});var tmpStat=this_._processData("stat",layers,data[0]),tmpHlStat=this_._processData("hl_stat",hlLayers,data[1]),_a=[Math.min(tmpStat[1],tmpHlStat[1]),Math.max(tmpStat[2],tmpHlStat[2])],min=_a[0],max=_a[1];if(_.each($scope.options,function(d){d.chart.width=iterSet.size,conf.sameScale&&(d.chart.yDomain=[min,max])}),_.merge($scope.data,tmpStat[0],tmpHlStat[0]),"norm1"===conf.type||"norm2"===conf.type){var mmin_1=Number.MAX_SAFE_INTEGER,mmax_1=Number.MIN_SAFE_INTEGER;_.each($scope.data,function(v,k){for(var i=0;i<v.length;i+=1)v[i].y/=$scope.size[k],v[i].y<mmin_1&&(mmin_1=v[i].y),v[i].y>mmax_1&&(mmax_1=v[i].y)}),_.each($scope.options,function(d){conf.sameScale&&(d.chart.yDomain=[mmin_1,mmax_1])})}})}else if("boxPlot"===conf.chartType){for(var _e=0,tree_2=tree;_e<tree_2.length;_e++){var d=tree_2[_e];if($scope.opened[d.name]=!1,$scope.options[d.name]=this_._setOptions("boxPlotChart"),$scope.showTypes[d.name]="nvd3",layerTree[d.name]=d,d.nodes){hlLayers.push(d.name);for(var _f=0,_g=d.nodes;_f<_g.length;_f++){var dn=_g[_f];if(dn.parent=d,$scope.opened[dn.name]=!1,$scope.options[dn.name]=this_._setOptions("boxPlotChart"),$scope.showTypes[dn.name]="nvd3",layerTree[dn.name]=dn,dn.nodes){hlLayers.push(dn.name);for(var _h=0,_j=dn.nodes;_h<_j.length;_h++){var dnn=_j[_h];dnn.parent=dn,$scope.opened[dnn.name]=!1,$scope.options[dnn.name]=this_._setOptions("boxPlotChart"),$scope.showTypes[dnn.name]="nvd3",layerTree[dnn.name]=dnn}}}}}for(var db=Global.getSelectedDB(),parser="json",types=[conf.gw+"_min",conf.gw+"_quarter1",conf.gw+"_mean",conf.gw+"_quarter3",conf.gw+"_max"],queryQueue=[],_k=0,types_1=types;_k<types_1.length;_k++){var type=types_1[_k];queryQueue.push(DataManager.fetchLayer({db:db,type:type,parser:parser},!1))}for(var _l=0,types_2=types;_l<types_2.length;_l++){var type=types_2[_l];queryQueue.push(DataManager.fetchLayer({db:db,type:"hl_"+type,parser:parser},!1))}$("#layer-data-loading").removeClass("invisible"),$q.all(queryQueue).then(function(data){$("#layer-data-loading").addClass("invisible"),$scope.data={};for(var ss=_.range(0,iterSet.size,2),i=0;i<data.length;i+=1){data[i]=_.filter(data[i],function(d){return iterSet.has(d.iter)});for(var tmp=[],_i=0,ss_1=ss;_i<ss_1.length;_i++){var j=ss_1[_i];tmp.push(data[i][j])}data[i]=tmp}var tmpStat=this_._processData("boxPlot",layers,data.slice(0,5)),tmpHlStat=this_._processData("hl_boxPlot",hlLayers,data.slice(5,10)),_a=[Math.min(tmpStat[1],tmpHlStat[1]),Math.max(tmpStat[2],tmpHlStat[2])],min=_a[0],max=_a[1];_.each($scope.options,function(d){d.chart.width=iterSet.size,conf.sameScale&&(d.chart.yDomain=[min,max])}),_.merge($scope.data,tmpStat[0],tmpHlStat[0])})}else if("crChart"===conf.chartType){for(var _m=0,tree_3=tree;_m<tree_3.length;_m++){var d=tree_3[_m];if($scope.opened[d.name]=!1,$scope.optionsCR[d.name]=this_._setOptions("crChart"),$scope.optionsCR[d.name].name=d.name,$scope.showTypes[d.name]="cr",layerTree[d.name]=d,d.nodes){hlLayers.push(d.name);for(var _o=0,_p=d.nodes;_o<_p.length;_o++){var dn=_p[_o];if(dn.parent=d,$scope.opened[dn.name]=!1,$scope.optionsCR[dn.name]=this_._setOptions("crChart"),$scope.optionsCR[dn.name].name=d.name,$scope.showTypes[dn.name]="cr",layerTree[dn.name]=dn,dn.nodes){hlLayers.push(dn.name);for(var _q=0,_r=dn.nodes;_q<_r.length;_q++){var dnn=_r[_q];dnn.parent=dn,$scope.opened[dnn.name]=!1,$scope.optionsCR[dnn.name]=this_._setOptions("crChart"),$scope.optionsCR[dnn.name].name=d.name,$scope.showTypes[dnn.name]="cr",layerTree[dnn.name]=dnn}}}}}$("#layer-data-loading").removeClass("invisible");var db=Global.getSelectedDB(),parser="json",seqidx=conf.selectedRatio;$q.all([DataManager.fetchLayer({db:db,type:"s_cratio",seqidx:seqidx,parser:parser},!1),DataManager.fetchLayer({db:db,type:"hl_s_cratio",seqidx:seqidx,parser:parser},!1)]).then(function(data){$("#layer-data-loading").addClass("invisible"),$scope.dataCR={},_.merge($scope.dataCR,this_._processData("seq",layers,data[0]),this_._processData("hl_seq",hlLayers,data[1])),_.each($scope.optionsCR,function(d){d.width=iterSet.size}),_.each($scope.dataCR,function(d){d.value=_.filter(d.value,function(o,i){return iterSet.has(d.iter[i])}),d.iter=_.filter(d.iter,function(o){return iterSet.has(o)})})})}else if("horizonGraph"===conf.chartType){for(var _s=0,tree_4=tree;_s<tree_4.length;_s++){var d=tree_4[_s];if($scope.opened[d.name]=!1,$scope.optionsHGraph[d.name]=this_._setOptions("horizonGraph"),$scope.size[d.name]=0,d.nodes||($scope.size[d.name]=layers[d.name].kernelNum*layers[d.name].channels*layers[d.name].kernelWidth+layers[d.name].kernelHeight),$scope.showTypes[d.name]="hgraph",layerTree[d.name]=d,d.nodes){hlLayers.push(d.name);for(var _t=0,_u=d.nodes;_t<_u.length;_t++){var dn=_u[_t];if(dn.parent=d,$scope.opened[dn.name]=!1,$scope.optionsHGraph[dn.name]=this_._setOptions("horizonGraph"),$scope.size[dn.name]=0,$scope.showTypes[dn.name]="hgraph",layerTree[dn.name]=dn,dn.nodes){hlLayers.push(dn.name);for(var _v=0,_w=dn.nodes;_v<_w.length;_v++){var dnn=_w[_v];dnn.parent=dn,$scope.opened[dnn.name]=!1,$scope.optionsHGraph[dnn.name]=this_._setOptions("horizonGraph"),$scope.size[dnn.name]=layers[dnn.name].kernelNum*layers[dnn.name].channels*layers[dnn.name].kernelWidth+layers[dnn.name].kernelHeight,$scope.size[dn.name]+=$scope.size[dnn.name],$scope.size[d.name]+=$scope.size[dnn.name],$scope.showTypes[dnn.name]="hgraph",layerTree[dnn.name]=dnn}}}}}var db=Global.getSelectedDB(),parser="json";$("#layer-data-loading").removeClass("invisible"),$q.all([DataManager.fetchLayer({db:db,type:conf.gw+"_"+conf.type,parser:parser},!1),DataManager.fetchLayer({db:db,type:"hl_"+conf.gw+"_"+conf.type,parser:parser},!1)]).then(function(data){$("#layer-data-loading").addClass("invisible"),$scope.dataHGraph={},data[0]=_.filter(data[0],function(d){return iterSet.has(d.iter)}),data[1]=_.filter(data[1],function(d){return iterSet.has(d.iter)});var tmpStat=this_._processData("stat_hgraph",layers,data[0]),tmpHlStat=this_._processData("hl_stat_hgraph",hlLayers,data[1]),_a=[Math.min(tmpStat[1],tmpHlStat[1]),Math.max(tmpStat[2],tmpHlStat[2])],min=_a[0],max=_a[1];if(console.log(tmpStat[1],tmpHlStat[1],tmpStat[2],tmpHlStat[2]),_.each($scope.optionsHGraph,function(d){d.width=iterSet.size,d.band=conf.band,conf.sameScale&&(d.yDomain=[min,max])}),_.merge($scope.dataHGraph,tmpStat[0],tmpHlStat[0]),"norm1"===conf.type||"norm2"===conf.type){var mmin_2=Number.MAX_SAFE_INTEGER,mmax_2=Number.MIN_SAFE_INTEGER;_.each($scope.dataHGraph,function(v,k){for(var i=0;i<v.length;i+=1)v[i][1]/=$scope.size[k],v[i][1]<mmin_2&&(mmin_2=v[i][1]),v[i][1]>mmax_2&&(mmax_2=v[i][1])}),_.each($scope.optionsHGraph,function(d){conf.sameScale&&(d.yDomain=[mmin_2,mmax_2])})}})}previousOpen?$scope.opened=previousOpen:previousOpen=$scope.opened,$timeout(function(){$(".tree-btn").hover(function(){$(this).find(".zoombtn").show()},function(){$(this).find(".zoombtn").hide()})},1e3)}this.$scope=$scope,this.DataManager=DataManager,this.Global=Global,this.$q=$q,this.Pip=Pip,this.$timeout=$timeout;var layers,allLayers,this_=this,layerTree={},hlLayers=[],previousOpen=null,oldShowType={};$scope.showTypes={},this_._init(),$scope.click=function(type,name){if("nvd3"===$scope.showTypes[name]){if("zoomin"===type){var tmp=$scope.options[name].chart.height;tmp*=1.5,tmp<=800&&($scope.options[name].chart.height=tmp)}else if("zoomout"===type){var tmp=$scope.options[name].chart.height;tmp/=1.5,tmp>=40&&($scope.options[name].chart.height=tmp)}}else"pchart"!==$scope.showTypes[name]&&"cr"!==$scope.showTypes[name]||("zoomin"===type?$scope.$broadcast("zoom",{type:"in",name:name}):$scope.$broadcast("zoom",{type:"out",name:name}))},Pip.onShowTopKernel($scope,function(msg){for(var parser="json",type="i_cosine",db=Global.getSelectedDB(),iterInfo=Global.getData("iter"),allQuery=[],_i=0,_a=iterInfo.picked;_i<_a.length;_i++){var iter=_a[_i];allQuery.push(DataManager.fetchKernel({db:db,type:type,iter:iter[1],parser:parser},!1))}$("#layer-data-loading").removeClass("invisible"),$q.all(allQuery).then(function(data){var map=new Map;_.each(data,function(d){for(var i=0;i<d.length;i+=1){var name_1=d[i].lid.toString()+"."+d[i].idx.toString();map.has(name_1)||map.set(name_1,{count:0,d:[]});var td=map.get(name_1);td.count+=1,td.d.push(d[i])}});var lmap=new Map;map.forEach(function(v,k){lmap.has(v.d[0].name)||lmap.set(v.d[0].name,{v:[],lid:v.d[0].lid});var tmp=lmap.get(v.d[0].name);tmp.v.push(v.d[0].idx)});var qArray={};lmap.forEach(function(v,k){qArray[k]=DataManager.fetchKernel({db:db,type:type,layer:[v.lid],seqidx:v.v,parser:parser},!1)}),$scope.dataTopK={},$scope.optionsTopK={},_.isEmpty(qArray)||$q.all(qArray).then(function(kernelData){$("#layer-data-loading").addClass("invisible"),_.each(kernelData,function(v,k){$scope.dataTopK[k]=_.map(v,function(vd){return{heatmapData:vd.value,linechartData:null}}),$scope.showTypes[k]="topk",$scope.optionsTopK[k]=this_._setOptions("heatline"),$scope.optionsTopK[k].num=$scope.layers[k].kernelNum;var cnode=layerTree[k],count=0;cnode.parent&&($scope.opened[cnode.parent.parent.name]=!0,$scope.opened[cnode.parent.name]=!0,$("#"+cnode.parent.parent.name).show(),$("#"+cnode.parent.parent.name+" .level2").show(),$("#"+cnode.parent.name+" .level3").show(),count+=1)})})})}),Pip.onLayerConfigChanged($scope,function(conf){conf.show===!0&&act(conf)}),Pip.onModelChanged($scope,function(msg){var conf=Global.getConfig("layer");conf.show===!0&&act(conf)}),$scope.open=function(d,level){d.nodes?(level=" .level"+level,$scope.opened[d.name]?$("#"+d.name+level).hide(200,"linear"):$("#"+d.name+level).show(200,"linear"),$scope.opened[d.name]=!$scope.opened[d.name]):($scope.opened[d.name]=!$scope.opened[d.name],$scope.opened[d.name]?(oldShowType[d.name]=$scope.showTypes[d.name],$scope.showTypes[d.name]="pchart",openPixelChart(d)):$scope.showTypes[d.name]=oldShowType[d.name])}}return Controller.$inject=["$scope","DataManager","Global","$q","Pip","$timeout"],Controller.prototype._init=function(){var this_=this;this_.$scope.kData={a:1,b:2,c:3},this_.$timeout(function(){$("#widget-container-layerinfo .scrollable").each(function(){var $this=$(this);$(this).ace_scroll({size:$this.attr("data-size")||100})})},100),$("#widget-container-layerinfo").mouseenter(function(){$("#widget-container-layerinfo .widget-header").removeClass("invisible")}).mouseleave(function(){$("#widget-container-layerinfo .widget-header").addClass("invisible")}),$(".vl-div-global").on("nvd3-mouse-hover",function(evt,msg){this_.Pip.emitTimeMouseMove({point:[msg,0],x:0,y:0,k:1})})},Controller.prototype._processData=function(type){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];var result={},_a=[rest[0],rest[1]],layers=_a[0],data=_a[1],_b=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],min=_b[0],max=_b[1];switch(type){case"kernel":for(var _loop_2=function(d){result[d.name]={};for(var len=d.values[0].length,tmp=_.map(_.range(len),function(idx){return{iter:d.domain,value:[],index:idx}}),_i=0,_a=d.values;_i<_a.length;_i++)for(var v=_a[_i],i=0;i<len;i+=1)tmp[i].value.push(v[i]>.05?0:1);result[d.name].pixelChart=tmp},_c=0,data_1=data;_c<data_1.length;_c++){var d=data_1[_c];_loop_2(d)}return result;case"stat":return _.each(layers,function(v){result[v.name]=_.map(data,function(dv){return min=dv.value[v.lid]<min?dv.value[v.lid]:min,max=dv.value[v.lid]>max?dv.value[v.lid]:max,{x:dv.iter,y:dv.value[v.lid]}})}),[result,min,max];case"hl_stat":return _.each(layers,function(name){result[name]=_.map(data,function(dv){return min=dv.value[name]<min?dv.value[name]:min,max=dv.value[name]>max?dv.value[name]:max,{x:dv.iter,y:dv.value[name]}})}),[result,min,max];case"stat_hgraph":return _.each(layers,function(v){result[v.name]=_.map(data,function(dv){return min=dv.value[v.lid]<min?dv.value[v.lid]:min,max=dv.value[v.lid]>max?dv.value[v.lid]:max,[dv.iter,dv.value[v.lid]]})}),[result,min,max];case"hl_stat_hgraph":return _.each(layers,function(name){result[name]=_.map(data,function(dv){return min=dv.value[name]<min?dv.value[name]:min,max=dv.value[name]>max?dv.value[name]:max,[dv.iter,dv.value[name]]})}),[result,min,max];case"boxPlot":return _.each(layers,function(v){result[v.name]=[];for(var size=data[0].length,i=0;i<size;i+=1)min=data[0][i].value[v.lid]<min?data[0][i].value[v.lid]:min,max=data[4][i].value[v.lid]>max?data[4][i].value[v.lid]:max,result[v.name].push({x:data[0][i].iter,values:{whisker_low:data[0][i].value[v.lid],Q1:data[1][i].value[v.lid],Q2:data[2][i].value[v.lid],Q3:data[3][i].value[v.lid],whisker_high:data[4][i].value[v.lid]}})}),[result,min,max];case"hl_boxPlot":return _.each(layers,function(name){result[name]=[];for(var size=data[0].length,i=0;i<size;i+=1)min=data[0][i].value[name]<min?data[0][i].value[name]:min,max=data[4][i].value[name]>max?data[4][i].value[name]:max,result[name].push({x:data[0][i].iter,values:{whisker_low:data[0][i].value[name],Q1:data[1][i].value[name],Q2:data[2][i].value[name],Q3:data[3][i].value[name],whisker_high:data[4][i].value[name]}})}),[result,min,max];case"seq":return _.each(layers,function(v){var d=_.find(data,function(o){return+o.key===+v.lid});result[v.name]={iter:d.domain,value:d.values}}),result;case"hl_seq":return _.each(layers,function(name){var d=_.find(data,{key:name});result[name]={iter:d.domain,value:d.values}}),result}},Controller.prototype._setOptions=function(type){var options,this_=this;switch(type){case"sparklinePlus":options={chart:{type:"sparklinePlus",width:757,height:35,margin:{left:0,right:0,top:1,bottom:0},showLastValue:!1,color:function(d,i){return"#4682b4"},x:function(d,i){return d.x},xTickFormat:function(d){return d},yTickFormat:function(d){return d4.format(".3s")(d)},duration:250}};break;case"boxPlotChart":options={chart:{type:"boxPlotChart",height:35,margin:{left:0,right:0,top:2,bottom:2},color:["#4682b4"],x:function(d,i){return d.x},y:function(d,i){return d.y},xAxis:{tickFormat:function(d){return d}},yAxis:{tickFormat:function(d){return d3.format(",.3s")(d)}},showXAxis:!1,showYAxis:!1,maxBoxWidth:1}};break;case"crChart":options={width:757,height:35,cellWidth:1,marginTop:1,margin:{top:1,right:0,bottom:1,left:0},ratio:null};break;case"heatline":options={width:this_.Global.getData("iter").num+30,height:12,cellWidth:1,color:d4.scaleSequential(d4.interpolateBlues),margin:{top:1,right:0,bottom:0,left:0},type:"kernel",lineChart:!1};break;case"horizonGraph":options={width:this_.Global.getData("iter").num+30,height:35,cellWidth:1,marginTop:1,color:d4.scaleSequential(d4.interpolateBlues),margin:{top:1,right:0,bottom:0,left:0}};break;case"pixelChartWithLine":options={width:757,height:60,cellWidth:1,pixelChart:!0,lineChart:!1,color:d4.scaleSequential(d4.interpolateBlues),marginTop:0,margin:{top:2,right:0,bottom:2,left:0}};break;default:return null}return options},Controller}();Controller.$inject=["$scope","DataManager","Global","$q","Pip","$timeout"],angular.module("vis").controller("LayerController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,Global,Pip,$timeout){function act(data,conf){$scope.show={lr:conf.lr,error:conf.testError||conf.trainError,loss:conf.testLoss||conf.trainLoss},$scope.data={},$scope.options={};var color=d3.scale.category10().range();if($scope.show.lr&&($scope.data.lr=this_._process("sparklinePlus",data.lr),$scope.options.lr=this_._setOption("sparklinePlus",data.lr.length,color),$scope.options.lr.chart.height=15,$scope.options.lr.chart.showMinMaxPoints=!1),$scope.show.error)if(conf.testError&&conf.trainError)$scope.data.error=this_._process("lineChart",data.testError,data.trainError),$scope.options.error=this_._setOption("lineChart",data.testError.length,color);else{var myColor=color;conf.trainError&&(myColor=color.slice(1));var d=conf.testError?data.testError:data.trainError;$scope.data.error=this_._process("sparklinePlus",d),$scope.options.error=this_._setOption("sparklinePlus",d.length,myColor)}if($scope.show.loss)if(conf.testLoss&&conf.trainLoss)$scope.data.loss=this_._process("lineChart",data.testLoss,data.trainLoss),$scope.options.loss=this_._setOption("lineChart",data.testLoss.length,color);else{var myColor=color;conf.trainLoss&&(myColor=color.slice(1));var d=conf.testLoss?data.testLoss:data.trainLoss;$scope.data.loss=this_._process("sparklinePlus",d),$scope.options.loss=this_._setOption("sparklinePlus",d.length,myColor)}}this.$scope=$scope,this.Global=Global,this.Pip=Pip,this.$timeout=$timeout;var this_=this;this_._init(),$scope.click=function(type,ctype){if("zoomin"===type){var tmp=$scope.options[ctype].chart.height+100;tmp<=800&&($scope.options[ctype].chart.height=tmp)}else if("zoomout"===type){var tmp=$scope.options[ctype].chart.height-100;tmp>=20&&($scope.options[ctype].chart.height=tmp)}},Pip.onModelChanged($scope,function(msg){var data=Global.getData("record"),conf=Global.getConfig("record");act(data,conf)}),Pip.onRecordConfigChanged($scope,function(conf){if(conf.show===!0){var data=Global.getData("record");act(data,conf)}})}return Controller.$inject=["$scope","Global","Pip","$timeout"],Controller.prototype._init=function(){var this_=this;this_.$timeout(function(){$("#widget-container-recordinfo .scrollable").each(function(){var $this=$(this);$(this).ace_scroll({size:$this.attr("data-size")||100})})},100),$("#widget-container-recordinfo").mouseenter(function(){$("#widget-container-recordinfo .widget-header").removeClass("invisible"),this_.$scope.$apply(function(){this_.$scope.btnShow=!0})}).mouseleave(function(){$("#widget-container-recordinfo .widget-header").addClass("invisible"),this_.$scope.$apply(function(){this_.$scope.btnShow=!1})})},Controller.prototype._process=function(type){for(var rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments[_i];var result,data;switch(type){case"lineChart":data={test:rest[0],train:rest[1]},result=[{key:"validation",values:_.map(rest[0],function(d){return{x:d.iter,y:d.value}})},{key:"train",values:_.map(rest[1],function(d){return{x:d.iter,y:d.value}})}];break;case"sparklinePlus":data=rest[0],data=_.sortBy(data,"iter"),result=_.map(data,function(d){return{x:d.iter,y:d.value}})}return result},Controller.prototype._setOption=function(type,width,color){var options,this_=this;switch(type){case"sparklinePlus":options={chart:{type:"sparklinePlus",height:50,width:width?width:this_.Global.getData("iter").num,margin:{left:0,right:0,top:1,bottom:1},color:color,showMinMaxPoints:!0,showLastValue:!1,showCurrentPoint:!1,x:function(d,i){return d.x},y:function(d,i){return d.y},xTickFormat:function(d){return d},duration:250}};break;case"lineChart":options={chart:{type:"lineChart",color:color,width:width?width:this_.Global.getData("iter").num,height:50,margin:{top:1,right:0,bottom:1,left:0},interactiveLayer:{dispatch:{elementMousemove:function(msg){this_.Pip.emitTimeMouseMove({point:[msg.mouseX,msg.mouseY],x:0,y:0,k:1})}}},noData:" ",x:function(d){return d.x},y:function(d){return d.y},useInteractiveGuideline:!0,showXAxis:!1,showYAxis:!1,showLegend:!1}};break;case"scatterChart":options={chart:{type:"scatterChart",width:width?width:this_.Global.getData("iter").num,height:50,margin:{top:1,right:0,bottom:1,left:0},x:function(d){return d.x},y:function(d){return d.y},color:d3.scale.category10().range(),scatter:{onlyCircles:!1},showDistX:!1,showDistY:!0,tooltipContent:function(key){return"<h3>"+key+"</h3>"},duration:350,xAxis:{axisLabel:"Iteration",tickFormat:function(d){return d}},yAxis:{axisLabel:"Value",tickFormat:function(d){return d3.format(".02f")(d)},axisLabelDistance:-5},zoom:{enabled:!1,scale:1,scaleExtent:[1,5],useFixedDomain:!1,useNiceScale:!0,horizontalOff:!1,verticalOff:!1,unzoomEventType:"dblclick.zoom"}}};break;default:alert("please choose one type of chart")}return options},Controller}();Controller.$inject=["$scope","Global","Pip","$timeout"],angular.module("vis").controller("RecordController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,Pip,Global,$q,DataManager){this.$scope=$scope,this.Pip=Pip,this.Global=Global,this.$q=$q,this.DataManager=DataManager;var this_=this;$scope.show=!1;var svg,focus,rect,svgContainer,picked,iterInfo=null,currentIdx=null,scale=null,vlDivContainer=d4.select("#vl-div-container"),color=d3.scale.category10().range();Pip.onModelChanged($scope,function(msg){function mouseOverHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOver({point:point,x:0,y:0,k:1})}function mouseOutHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOut({point:point,x:0,y:0,k:1})}function mouseMoveHandler(){var point=d4.mouse(this);Pip.emitTimeMouseMove({point:point,x:0,y:0,k:1})}function clickHandler(){var point=d4.mouse(this),idx=Math.trunc(point[0]);Pip.emitTimePicked([idx,iterInfo.array[idx]])}$scope.show=!0,iterInfo=Global.getData("iter"),$("#timebox").empty(),scale=d4.scaleLinear().domain(d4.extent(iterInfo.array)).range([0,iterInfo.num]);var axis=d4.axisTop(scale).ticks(10).tickFormat(d4.format(",.3s"));svg=d4.select("#timebox").attr("width",iterInfo.num+10).attr("height",34),rect=svg.append("rect").attr("class","overlay").attr("width",iterInfo.num+10).attr("height",34),svgContainer=svg.append("g"),svgContainer.append("g").attr("class","time-axis").attr("transform","translate(0, 20)").call(axis),picked=svg.append("g"),focus=svgContainer.append("g").style("display","none"),focus.append("circle").attr("cx",0).attr("cy",0).attr("r",3).attr("fill","#438EB9"),focus.append("text").attr("x",9).attr("dy","1em").attr("font-size",12),rect.on("mouseover",mouseOverHandler).on("mouseout",mouseOutHandler).on("mousemove",mouseMoveHandler).on("click",clickHandler)}),$scope.reset=function(){iterInfo.picked=null,$(picked.node()).empty(),$(".vl-div-pin").remove()},$scope.clean=function(){var disp=$(".vl-div-pin").css("display");console.log(disp),"none"===disp?$(".vl-div-pin").css("display","inline"):$(".vl-div-pin").css("display","none")},Pip.onTimePicked($scope,function(msg){if(msg||Global.getConfig("timebox").pin){var ci,cv;msg?(ci=msg[0],cv=msg[1]):(ci=currentIdx,cv=iterInfo.array[currentIdx]),iterInfo.picked||(iterInfo.picked=[]),iterInfo.picked.push([ci,cv]);var myColor=color[iterInfo.picked.length];picked.append("circle").attr("cx",scale(cv)).attr("cy",20).attr("r",2).attr("fill",myColor);var offset=$("#timebox").offset().left-$(".vl-div-global").parent().offset().left;vlDivContainer.append("div").attr("class","vl-div-pin").style("border-left","1px dashed "+myColor).style("opacity",.5).style("left",offset+scale(cv)+"px")}}),Pip.onTimeMouseOver($scope,function(msg){focus.style("display","inline")}),Pip.onTimeMouseOut($scope,function(msg){focus.style("display","none")}),Pip.onTimeMouseMove($scope,function(msg){var point=msg.point,x=msg.x,k=(msg.y,msg.k),v=(point[0]-x)/k;focus.attr("transform","translate("+v+",20)"),currentIdx=Math.trunc(v),focus.select("text").text(iterInfo.array[currentIdx].toString());var offset=$("#timebox").offset().left-$(".vl-div-global").parent().offset().left;$(".vl-div-global").css("left",offset+v)}),$("#timebox-title").mouseenter(function(){this_.$scope.$apply(function(){this_.$scope.btnShow=!0})}).mouseleave(function(){this_.$scope.$apply(function(){this_.$scope.btnShow=!1})})}return Controller.$inject=["$scope","Pip","Global","$q","DataManager"],Controller}();Controller.$inject=["$scope","Pip","Global","$q","DataManager"],angular.module("vis").controller("TimeBoxController",Controller)}(application||(application={}));
"use strict";var application;!function(application){var Controller=function(){function Controller($scope,DataManager,Global,Pip){this.$scope=$scope,this.DataManager=DataManager,this.Global=Global,this.Pip=Pip,$scope.click=function(){Pip.emitTimePicked(null)},$scope.config=Global.getConfig(),Pip.onRecordConfigChanged($scope,function(conf){$scope.config.record=conf}),Pip.onLabelConfigChanged($scope,function(conf){$scope.config.label=conf}),Pip.onLayerConfigChanged($scope,function(conf){$scope.config.layer=conf}),Pip.onTimeboxConfigChanged($scope,function(conf){$scope.config.timebox=conf}),$(document).on("shown.ace.widget hidden.ace.widget closed.ace.widget",".widget-box",function(event){var widgets=ace.data.get("demo","widget-state",!0);null==widgets&&(widgets={});var id=$(this).attr("id");widgets[id]=event.type,ace.data.set("demo","widget-state",widgets,null,!0)}),function(){var container_list=ace.data.get("demo","widget-order",!0);if(container_list)for(var container_id in container_list)if(container_list.hasOwnProperty(container_id)){var widgets_inside_container=container_list[container_id];if(0===widgets_inside_container.length)continue;for(var i=0;i<widgets_inside_container.length;i++){var widget=widgets_inside_container[i];$("#"+widget).appendTo("#"+container_id)}}var widgets=ace.data.get("demo","widget-state",!0);if(null!=widgets)for(var id in widgets)if(widgets.hasOwnProperty(id)){var state=widgets[id],widget=$("#"+id);"shown"===state&&widget.hasClass("collapsed")||"hidden"===state&&!widget.hasClass("collapsed")?widget.widget_box("toggleFast"):"closed"===state&&widget.widget_box("closeFast")}$("#main-widget-container").removeClass("invisible"),$("#reset-widgets").on("click",function(){ace.data.remove("demo","widget-state"),ace.data.remove("demo","widget-order"),document.location.reload()})}(),$("#widget-container-labelinfo").mouseenter(function(){$("#labelinfo-header").removeClass("invisible")}).mouseleave(function(){$("#labelinfo-header").addClass("invisible")}),$("#widget-container-labelinfo-model").mouseenter(function(){$("#widget-container-labelinfo-model .widget-header").removeClass("invisible")}).mouseleave(function(){$("#widget-container-labelinfo-model .widget-header").addClass("invisible")}),$("#widget-container-labelinfo-cls").mouseenter(function(){$("#widget-container-labelinfo-cls .widget-header").removeClass("invisible")}).mouseleave(function(){$("#widget-container-labelinfo-cls .widget-header").addClass("invisible")}),$("#widget-container-labelinfo-detail").mouseenter(function(){$("#widget-container-labelinfo-detail .widget-header").removeClass("invisible")}).mouseleave(function(){$("#widget-container-labelinfo-detail .widget-header").addClass("invisible")})}return Controller.$inject=["$scope","DataManager","Global","Pip"],Controller}();Controller.$inject=["$scope","DataManager","Global","Pip"],angular.module("vis").controller("VisualizationController",Controller)}(application||(application={}));
var application;!function(application){"use strict";var Painter=function(){function Painter(ele,options,data){this.options=options,this.data=data;var _a=[data.iter.length,options.height],dw=_a[0],dh=_a[1];this.container=d4.select(ele[0]).style("width",dw+15+"px").style("height",options.marginTop+dh*options.hScale+"px").style("position","relative").style("background","white"),this.canvas=this.container.append("canvas").style("position","absolute").style("top",options.marginTop+"px").attr("width",dw+"px").attr("height",dh*options.hScale+"px"),this.fakeCanvas=this.container.append("canvas").attr("width",dw+"px").attr("height",dh+"px").style("display","none"),this.offW=options.margin.left,this.offH=options.margin.top,this.width=dw-options.margin.left-options.margin.right,this.height=options.height-options.margin.top-options.margin.bottom}return Painter.prototype.render=function(data,Pip,scope,Global){function drawImage(){var canvasWidth=this_.canvas.property("width"),canvasHeight=this_.canvas.property("height");ctx.save(),ctx.imageSmoothingEnabled=!1,ctx.clearRect(0,0,canvasWidth,canvasHeight),ctx.translate(sx,0),ctx.scale(sk,this_.options.hScale),ctx.drawImage(this_.fakeCanvas.node(),0,0),ctx.restore()}function zoomed(){var x=d4.event.transform.x,y=d4.event.transform.y,k=d4.event.transform.k;1===k&&(x=0,y=0,d4.event.transform.x=0,d4.event.transform.y=0),Pip.emitSyncHorizonScale({x:x,y:y,k:k})}function mouseOverHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOver({point:point,x:sx,y:sy,k:sk})}function mouseOutHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOut({point:point,x:sx,y:sy,k:sk})}function mouseMoveHandler(){var point=d4.mouse(this);Pip.emitTimeMouseMove({point:point,x:sx,y:sy,k:sk})}var this_=this,sx=0,sy=0,sk=1;this_.canvas.call(d4.zoom().scaleExtent([1,10]).on("zoom",zoomed)),this_.canvas.on("mouseover",mouseOverHandler).on("mouseout",mouseOutHandler).on("mousemove",mouseMoveHandler),this_._paintContext(this_.fakeCanvas.node().getContext("2d"),data);var ctx=this_.canvas.node().getContext("2d");drawImage(),scope.$on("zoom",function(evt,msg){var hScale=this_.options.hScale;if(scope.data&&scope.options.name===msg.name){"in"===msg.type?hScale+=.5:hScale-=.5,hScale=hScale<1?1:hScale,hScale=hScale>15?15:hScale,this_.options.hScale=hScale,console.log("redraw");var _a=[data.iter.length,this_.options.height],dw=_a[0],dh=_a[1];this_.container.style("width",dw+15+"px").style("height",this_.options.marginTop+dh*this_.options.hScale+"px"),this_.canvas.attr("width",dw+"px").attr("height",dh*this_.options.hScale+"px"),drawImage()}}),Pip.onSyncHorizonScale(scope,function(msg){var x=msg.x,y=msg.y,k=msg.k;_a=[x,y,k],sx=_a[0],sy=_a[1],sk=_a[2],drawImage();var _a}),Pip.onTimeMouseMove(scope,function(msg){var canvasHeight=this_.canvas.property("height");drawImage(),ctx.save(),ctx.setLineDash([4,4]),ctx.beginPath(),ctx.translate(.5,.5),ctx.moveTo(msg.point[0],0),ctx.lineTo(msg.point[0],canvasHeight),ctx.strokeStyle="#5096df",ctx.lineWidth=.5,ctx.stroke(),ctx.restore()}),Pip.onTimeMouseOut(scope,function(msg){drawImage()})},Painter.prototype._paintContext=function(ctx,data){var oh,nowh,lasth,this_=this,color=this_._buildColorMap(data.value[0].length+1),h=function(mul){return this_.height*mul};_.each(data.value,function(d,idx){_a=[0,0,this_.height],oh=_a[0],nowh=_a[1],lasth=_a[2],_.each(d,function(o,k){nowh=h(o),ctx.fillStyle=color[k],ctx.fillRect(this_.offW+ +idx,this_.offH+oh,this_.options.cellWidth,lasth-nowh),oh+=lasth-nowh,lasth=nowh}),nowh=0,ctx.fillStyle=color[d.length],ctx.fillRect(this_.offW+ +idx,this_.offH+oh,this_.options.cellWidth,lasth-nowh);var _a})},Painter.prototype._buildColorMap=function(index){var colorMappingTable={2:["#fc6621","#a7ed6d"],3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]};return colorMappingTable[index]},Painter}(),Directive=function(){function Directive(Pip,Global){this.restrict="A",this.scope={options:"=",data:"="},this.link=function(scope,element,attrs){var hScale=1,start=function(){element.empty(),scope.options.hScale=hScale;var board=new Painter(element,scope.options,scope.data);board.render(scope.data,Pip,scope,Global)};_.isUndefined(scope.data)||start(),scope.$watch("data",function(n,o){n!==o&&n&&start()},!1)}}return Directive.factory=function(){var directive=function(Pip,Global){return new Directive(Pip,Global)};return directive.$inject=["Pip","Global"],directive},Directive}();angular.module("vis").directive("crchart",Directive.factory())}(application||(application={}));
var application;!function(application){"use strict";var Painter=function(){function Painter(ele,options){this.options=options;var container=d4.select(ele[0]).style("width",options.width?options.width+"px":"100%").style("height",options.height?options.height+"px":"80px").style("position","relative").style("background","white");this.canvas=container.append("canvas").style("position","absolute").style("left",0).style("top",0).attr("width",options.width?options.width+"px":"100%").attr("height",options.height?options.height+"px":"80px"),this.svg=d4.select(ele[0]).append("svg").style("position","absolute").style("left",0).style("top",0).style("width",options.width?options.width+"px":"100%").style("height",options.height?options.height+"px":"80px"),this.rect=this.svg.append("rect").attr("class","overlay").attr("width",options.width).attr("height",options.height),this.svg=this.svg.append("g"),this.offsetWidth=options.margin.left,this.offsetHeight=options.margin.top,this.width=ele.width()-options.margin.left-options.margin.right,this.height=ele.height()-options.margin.top-options.margin.bottom}return Painter.prototype.render=function(data,Pip){function mouseOverHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOver({point:point,x:0,y:0,k:1})}function mouseOutHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOut({point:point,x:0,y:0,k:1})}function mouseMoveHandler(){var point=d4.mouse(this);Pip.emitTimeMouseMove({point:point,x:0,y:0,k:1})}var this_=this;this_.Pip=Pip,this_.rect.on("mouseover",mouseOverHandler).on("mouseout",mouseOutHandler).on("mousemove",mouseMoveHandler),this_._paintHeatMap(data.heatmapData),this_.options.threshold>0&&(this_._addTriangles(data.linechartData),this_.options.triangle===!0?this_.svg.selectAll("polygon").style("display","inline"):this_.svg.selectAll("polygon").style("display","none"))},Painter.prototype._addTriangles=function(data){function clickHandler(d){this_.Pip.emitTimePicked([d.x,d.iter])}var this_=this,threshold=this_.options.threshold,triangleData=[];_.each(data,function(d,i){d.value>=threshold&&triangleData.push({x:i,y:d.value,iter:d.iter})});var scale=d4.scaleLinear().domain([this_.options.threshold,this_.options.max]).range([6,17]);this_.options.immediate&&scale.range([3,3]);var triangles=this_.svg.append("g");triangles.selectAll("polygon").data(triangleData).enter().append("polygon").attr("points",function(d){var w=scale(d.y);return"0,6, "+w+",-3 -"+w+",-3"}).attr("fill","#4682b4").attr("opacity",.9).attr("transform",function(d){return"translate("+d.x+", 3)"}).on("click",clickHandler).append("title").text(function(d){return"iter: "+d.iter+" value: "+d.y})},Painter.prototype._paintHeatMap=function(data){var this_=this,ctx=this_.canvas.node().getContext("2d"),size=data.length,lw=this_.options.cellWidth?this_.options.cellWidth:1,color=this_.options.color;if("kernel"===this_.options.type)for(var scale=d4.scaleLinear().domain(d4.extent(data,function(d){return d.value})).range([.01,.95]).clamp(!0),i=0;i<size;i+=1)ctx.beginPath(),ctx.moveTo(this_.offsetWidth+i*lw,this_.offsetHeight),ctx.lineTo(this_.offsetWidth+i*lw,this_.offsetHeight+this_.height),ctx.lineWidth=lw,ctx.strokeStyle=color(scale(data[i].value)).toString(),ctx.stroke();else for(var i=0;i<size;i+=1)ctx.beginPath(),ctx.moveTo(this_.offsetWidth+i*lw,this_.offsetHeight),ctx.lineTo(this_.offsetWidth+i*lw,this_.offsetHeight+this_.height),ctx.lineWidth=lw,ctx.strokeStyle=color(1-data[i].value).toString(),ctx.stroke()},Painter}(),Directive=function(){function Directive(Pip){this.restrict="A",this.scope={options:"=",data:"="},this.link=function(scope,element,attrs){var start=function(){element.empty();var board=new Painter(element,scope.options);board.render(scope.data,Pip)};_.isUndefined(scope.data)||start(),scope.$watch("data",function(n,o){n!==o&&n&&start()},!1)}}return Directive.factory=function(){var directive=function(Pip){return new Directive(Pip)};return directive.$inject=["Pip"],directive},Directive}();angular.module("vis").directive("heatline",Directive.factory())}(application||(application={}));
var application;!function(application){"use strict";var Painter=function(){function Painter(ele,options,data){this.options=options,this.data=data;var _a=[data.length,options.height],dw=_a[0],dh=_a[1];this.container=d4.select(ele[0]).style("width",dw+15+"px").style("height",options.marginTop+dh*options.hScale+"px").style("position","relative").style("background","white"),this.svg=this.container.append("svg").style("position","absolute").style("left",0).style("top",options.marginTop+"px").style("width",dw+15+"px").style("height",dh*options.hScale+"px").append("g").attr("transform","translate("+options.margin.left+","+options.margin.top+")"),this.offW=options.margin.left,this.offH=options.margin.top,this.width=dw-options.margin.left-options.margin.right,this.height=options.height-options.margin.top-options.margin.bottom}return Painter.prototype.render=function(data){var this_=this;console.log(this_.options.band);var chart=d3.horizon().width(this_.width).height(this_.height).bands(this_.options.band).mode("mirror").interpolate("basis");if(this_.options.yDomain){var t=this_.options.yDomain,tmax=Math.max(Math.abs(t[0]),Math.abs(t[1]));chart.max(tmax)}this_.svg.data([data]).call(chart)},Painter}(),Directive=function(){function Directive(Pip,Global){this.restrict="A",this.scope={options:"=",data:"="},this.link=function(scope,element,attrs){var hScale=1,start=function(){element.empty(),scope.options.hScale=hScale;var board=new Painter(element,scope.options,scope.data);board.render(scope.data)};_.isUndefined(scope.data)||start(),scope.$watch("data",function(n,o){n!==o&&n&&start()},!1)}}return Directive.factory=function(){var directive=function(Pip,Global){return new Directive(Pip,Global)};return directive.$inject=["Pip","Global"],directive},Directive}();angular.module("vis").directive("horizonGraph",Directive.factory())}(application||(application={}));
var application;!function(application){"use strict";var Painter=function(){function Painter(ele,options,data){this.options=options,this.data=data;var _a=[data.pixelChart[0].iter.length,data.pixelChart.length],dw=_a[0],dh=_a[1];this.container=d4.select(ele[0]).style("width",dw+15+"px").style("height",options.marginTop+dh*options.hScale+"px").style("position","relative").style("background","white"),this.svg=this.container.append("svg").style("position","absolute").style("width",dw+15+"px").style("height",options.marginTop+10+"px"),this.svg=this.svg.append("g").attr("transform","translate(0,"+options.marginTop+")"),this.canvas=this.container.append("canvas").style("position","absolute").style("top",options.marginTop+"px").attr("width",dw+"px").attr("height",dh*options.hScale+"px"),this.fakeCanvas=this.container.append("canvas").attr("width",dw+"px").attr("height",dh+"px").style("display","none"),this.offW=options.margin.left,this.offH=options.margin.top,this.width=options.width-options.margin.left-options.margin.right,this.height=options.height-options.margin.top-options.margin.bottom}return Painter.prototype.render=function(data,Pip,scope,Global){function drawImage(){var canvasWidth=this_.canvas.property("width"),canvasHeight=this_.canvas.property("height");ctx.save(),ctx.imageSmoothingEnabled=!1,ctx.clearRect(0,0,canvasWidth,canvasHeight),ctx.translate(sx,0),ctx.scale(sk,this_.options.hScale),ctx.drawImage(this_.fakeCanvas.node(),0,0),ctx.restore()}function zoomed(){var x=d4.event.transform.x,y=d4.event.transform.y,k=d4.event.transform.k;1===k&&(x=0,y=0,d4.event.transform.x=0,d4.event.transform.y=0),Pip.emitSyncHorizonScale({x:x,y:y,k:k})}function clickHandler(){var point=d4.mouse(this),row=Math.trunc(point[1]/this_.options.hScale),col=Math.trunc((point[0]-sx)/sk),tmp=_.find(data.pixelChart,function(d){return d.index===row});Global.getConfig("timebox").pin?Pip.emitTimePicked([col,tmp.iter[col]]):Pip.emitShowModal(tmp)}function mouseOverHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOver({point:point,x:sx,y:sy,k:sk})}function mouseOutHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOut({point:point,x:sx,y:sy,k:sk})}function mouseMoveHandler(){var point=d4.mouse(this);Pip.emitTimeMouseMove({point:point,x:sx,y:sy,k:sk})}var this_=this;this_.Pip=Pip;var sx=0,sy=0,sk=1;this_.canvas.call(d4.zoom().scaleExtent([1,10]).on("zoom",zoomed)).on("wheel",function(){d4.event.preventDefault()}),this_.canvas.on("click",clickHandler).on("mouseover",mouseOverHandler).on("mouseout",mouseOutHandler).on("mousemove",mouseMoveHandler);var svgContainer=this_.svg.append("g"),triangleData=[];_.each(data.lineChart,function(d,i){d.value>=this_.options.threshold&&triangleData.push({x:i,y:d.value,iter:d.iter})});var scale=d4.scaleLinear().domain([this_.options.threshold,this_.options.max]).range([6,17]);this_._addTriangles(svgContainer,triangleData,scale,[sx,sy,sk]),this_._paintPixelChart(this_.fakeCanvas.node().getContext("2d"),data.pixelChart);var ctx=this_.canvas.node().getContext("2d");ctx.save(),ctx.scale(1,this_.options.hScale),ctx.drawImage(this_.fakeCanvas.node(),0,0),ctx.restore(),this_.options.hScale>4&&this_._horizonLine(),Pip.onSyncHorizonScale(scope,function(msg){var x=msg.x,y=msg.y,k=msg.k;_a=[x,y,k],sx=_a[0],sy=_a[1],sk=_a[2],drawImage(),this_.options.hScale>4&&this_._horizonLine(),k>6&&this_._verticalLine(x,y,k),this_._addTriangles(svgContainer,triangleData,scale,[sx,sy,sk]);var _a}),Pip.onTimeMouseMove(scope,function(msg){var canvasHeight=this_.canvas.property("height");drawImage(),ctx.save(),ctx.setLineDash([4,4]),ctx.beginPath(),ctx.translate(.5,.5),ctx.moveTo(msg.point[0],0),ctx.lineTo(msg.point[0],canvasHeight),ctx.strokeStyle="#2184f5",ctx.lineWidth=1,ctx.stroke(),ctx.restore(),this_.options.hScale>4&&this_._horizonLine(),sk>6&&this_._verticalLine(sx,sy,sk),this_._addTriangles(svgContainer,triangleData,scale,[sx,sy,sk])}),Pip.onTimeMouseOut(scope,function(msg){drawImage(),this_.options.hScale>4&&this_._horizonLine(),sk>6&&this_._verticalLine(sx,sy,sk),this_._addTriangles(svgContainer,triangleData,scale,[sx,sy,sk])}),scope.$on("zoom",function(evt,msg){var hScale=this_.options.hScale;if(scope.data&&scope.data.pixelChart[0].cls===msg.cls){"in"===msg.type?hScale+=.5:hScale-=.5,hScale=hScale<1?1:hScale,hScale=hScale>15?15:hScale,this_.options.hScale=hScale,console.log("redraw");var _a=[data.pixelChart[0].iter.length,data.pixelChart.length],dw=_a[0],dh=_a[1];this_.container.style("width",dw+15+"px").style("height",this_.options.marginTop+dh*this_.options.hScale+"px"),this_.canvas.attr("width",dw+"px").attr("height",dh*this_.options.hScale+"px"),drawImage()}})},Painter.prototype._horizonLine=function(){for(var this_=this,ctx=this_.canvas.node().getContext("2d"),height=this_.canvas.property("height"),width=this_.canvas.property("width"),off=this_.options.hScale;off<height;)ctx.save(),ctx.beginPath(),ctx.translate(.5,.5),ctx.lineWidth=.5,ctx.strokeStyle="#6b6a6a",ctx.moveTo(0,off),ctx.lineTo(width,off),ctx.stroke(),off+=this_.options.hScale,ctx.restore()},Painter.prototype._verticalLine=function(x,y,k){var this_=this,ctx=this_.canvas.node().getContext("2d"),height=this_.canvas.property("height"),width=this_.canvas.property("width")*k,off=k;for(ctx.save(),ctx.translate(x,0);off<width;)ctx.save(),ctx.beginPath(),ctx.translate(.5,.5),ctx.lineWidth=.5,ctx.strokeStyle="#6b6a6a",ctx.moveTo(off,0),ctx.lineTo(off,height),ctx.stroke(),off+=k,ctx.restore();ctx.restore()},Painter.prototype._addTriangles=function(container,data,scale,tr){function clickHandler(d){this_.Pip.emitTimePicked([d.x,d.iter])}var x=tr[0],k=(tr[1],tr[2]),this_=this;if(this_.options.threshold){$(container.node()).empty();var panel=container.append("g");panel.selectAll("polygon").data(data).enter().append("polygon").attr("points",function(d){var w=scale(d.y);return"0,0 "+w+",-9 -"+w+",-9"}).attr("fill","#4682b4").attr("opacity",.9).attr("transform",function(d){return"translate("+(d.x*k+x+k/2)+", 0)"}).on("click",clickHandler).append("title").text(function(d){return"iter: "+d.iter+" value: "+d.y})}},Painter.prototype._paintPixelChart=function(ctx,data){for(var this_=this,colorFunc=this_.options.color,_i=0,data_1=data;_i<data_1.length;_i++){for(var d=data_1[_i],size=d.iter.length,image=ctx.createImageData(size,1),i=0;i<size;i+=1){var color=void 0;color=d4.color(colorFunc(d.value[i])).rgb(),image.data[4*i+0]=color.r,image.data[4*i+1]=color.g,image.data[4*i+2]=color.b,image.data[4*i+3]=255}ctx.putImageData(image,0,0+d.index)}},Painter}(),Directive=function(){function Directive(Pip,Global){this.restrict="A",this.scope={options:"=",data:"="},this.link=function(scope,element,attrs){var hScale=1,start=function(){element.empty(),scope.options.hScale=hScale;var board=new Painter(element,scope.options,scope.data);board.render(scope.data,Pip,scope,Global)};_.isUndefined(scope.data)||start(),scope.$watch("data",function(n,o){n!==o&&n&&start()},!1)}}return Directive.factory=function(){var directive=function(Pip,Global){return new Directive(Pip,Global)};return directive.$inject=["Pip","Global"],directive},Directive}();angular.module("vis").directive("imgPixel",Directive.factory())}(application||(application={}));
var application;!function(application){"use strict";var Painter=function(){function Painter(ele,options,data){this.options=options,this.data=data;var _a=[data.pixelChart[0].iter.length,data.pixelChart.length],dw=_a[0],dh=_a[1];this.container=d4.select(ele[0]).style("width",dw+15+"px").style("height",options.marginTop+dh*options.hScale+"px").style("position","relative").style("background","white"),this.canvas=this.container.append("canvas").style("position","absolute").style("top",options.marginTop+"px").attr("width",dw+"px").attr("height",dh*options.hScale+"px"),this.fakeCanvas=this.container.append("canvas").attr("width",dw+"px").attr("height",dh+"px").style("display","none"),this.offW=options.margin.left,this.offH=options.margin.top,this.width=options.width-options.margin.left-options.margin.right,this.height=options.height-options.margin.top-options.margin.bottom}return Painter.prototype.render=function(data,Pip,scope,Global){function drawImage(){var canvasWidth=this_.canvas.property("width"),canvasHeight=this_.canvas.property("height");ctx.save(),ctx.imageSmoothingEnabled=!1,ctx.clearRect(0,0,canvasWidth,canvasHeight),ctx.translate(sx,0),ctx.scale(sk,this_.options.hScale),ctx.drawImage(this_.fakeCanvas.node(),0,0),ctx.restore()}function zoomed(){var x=d4.event.transform.x,y=d4.event.transform.y,k=d4.event.transform.k;1===k&&(x=0,y=0,d4.event.transform.x=0,d4.event.transform.y=0),Pip.emitSyncHorizonScale({x:x,y:y,k:k})}function mouseOverHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOver({point:point,x:sx,y:sy,k:sk})}function mouseOutHandler(){var point=d4.mouse(this);Pip.emitTimeMouseOut({point:point,x:sx,y:sy,k:sk})}function mouseMoveHandler(){var point=d4.mouse(this);Pip.emitTimeMouseMove({point:point,x:sx,y:sy,k:sk})}var this_=this;this_.Pip=Pip;var sx=0,sy=0,sk=1;this_.canvas.call(d4.zoom().scaleExtent([1,10]).on("zoom",zoomed)).on("wheel",function(){d4.event.preventDefault()}),this_.canvas.on("mouseover",mouseOverHandler).on("mouseout",mouseOutHandler).on("mousemove",mouseMoveHandler),this_._paintPixelChart(this_.fakeCanvas.node().getContext("2d"),data.pixelChart);var ctx=this_.canvas.node().getContext("2d");ctx.save(),ctx.scale(1,this_.options.hScale),ctx.drawImage(this_.fakeCanvas.node(),0,0),ctx.restore(),Pip.onSyncHorizonScale(scope,function(msg){var x=msg.x,y=msg.y,k=msg.k;_a=[x,y,k],sx=_a[0],sy=_a[1],sk=_a[2],drawImage();var _a}),Pip.onTimeMouseMove(scope,function(msg){var canvasHeight=this_.canvas.property("height");drawImage(),ctx.save(),ctx.setLineDash([4,4]),ctx.beginPath(),ctx.translate(.5,.5),ctx.moveTo(msg.point[0],0),ctx.lineTo(msg.point[0],canvasHeight),ctx.strokeStyle="#FFFF00",ctx.lineWidth=.5,ctx.stroke(),ctx.restore()}),Pip.onTimeMouseOut(scope,function(msg){drawImage()}),scope.$on("zoom",function(evt,msg){var hScale=this_.options.hScale;if(scope.data&&scope.options.name===msg.name){"in"===msg.type?hScale+=.5:hScale-=.5,hScale=hScale<1?1:hScale,hScale=hScale>15?15:hScale,this_.options.hScale=hScale,console.log("redraw");var _a=[data.pixelChart[0].iter.length,data.pixelChart.length],dw=_a[0],dh=_a[1];this_.container.style("width",dw+15+"px").style("height",this_.options.marginTop+dh*this_.options.hScale+"px"),this_.canvas.attr("width",dw+"px").attr("height",dh*this_.options.hScale+"px"),drawImage()}})},Painter.prototype._paintPixelChart=function(ctx,data){for(var this_=this,colorFunc=this_.options.color,_i=0,data_1=data;_i<data_1.length;_i++){for(var d=data_1[_i],size=d.iter.length,image=ctx.createImageData(size,1),i=0;i<size;i+=1){var color=void 0;color=d4.color(colorFunc(d.value[i])).rgb(),image.data[4*i+0]=color.r,image.data[4*i+1]=color.g,image.data[4*i+2]=color.b,image.data[4*i+3]=255}ctx.putImageData(image,0,0+d.index)}},Painter}(),Directive=function(){function Directive(Pip,Global){this.restrict="A",this.scope={options:"=",data:"="},this.link=function(scope,element,attrs){var hScale=1,start=function(){element.empty(),scope.options.hScale=hScale;var board=new Painter(element,scope.options,scope.data);board.render(scope.data,Pip,scope,Global)};_.isUndefined(scope.data)||start(),scope.$watch("data",function(n,o){n!==o&&n&&start()},!1)}}return Directive.factory=function(){var directive=function(Pip,Global){return new Directive(Pip,Global)};return directive.$inject=["Pip","Global"],directive},Directive}();angular.module("vis").directive("kernelPixel",Directive.factory())}(application||(application={}));